<!DOCTYPE html>
<html>
<head>
    <title>Run Altamash Run - Mobile Fullscreen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { 
            margin: 0; 
            background-color: #000; 
            overflow: hidden; 
            touch-action: none; 
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: sans-serif;
        }
        
        /* The Game Container keeps the aspect ratio correct */
        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 850px; /* Prevents it from getting too wide on PC */
            max-height: 480px;
            background: #0d1117;
        }

        canvas { 
            display: block; 
            width: 100%; 
            height: 100%; 
        }
        
        /* UI LAYERS */
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        
        #score-board { 
            position: absolute; top: 15px; left: 15px; 
            color: #ffd700; font-size: 20px; font-weight: bold; 
            text-shadow: 2px 2px 0 #000;
        }

        #mute-btn { 
            position: absolute; top: 15px; right: 15px; 
            font-size: 28px; pointer-events: auto; cursor: pointer; 
            text-shadow: 0 0 5px black;
        }

        #message { 
            position: absolute; top: 40%; width: 100%; text-align: center; 
            color: white; font-size: 35px; font-weight: bold; 
            text-shadow: 0 0 10px blue; display: none; 
        }

        /* CONTROLS - Fixed at bottom */
        #controls { 
            position: absolute; bottom: 15px; width: 100%; height: 80px; 
            display: flex; justify-content: space-between; padding: 0 20px; 
            box-sizing: border-box; pointer-events: none; 
        }
        .btn { 
            width: 70px; height: 70px; 
            background: rgba(255,255,255,0.15); 
            border-radius: 50%; border: 2px solid rgba(255,255,255,0.5); 
            display: flex; align-items: center; justify-content: center; 
            color: white; font-size: 30px; 
            pointer-events: auto; backdrop-filter: blur(5px); 
            user-select: none; -webkit-user-select: none;
        }
        .btn:active { background: rgba(255,255,255,0.4); transform: scale(0.95); }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>

    <div id="ui-layer">
        <div id="score-board">üí∞ 0</div>
        <div id="mute-btn">üîá</div>
        <div id="message">GAME OVER</div>
    </div>

    <div id="controls">
        <div style="display:flex; gap:15px;">
            <div class="btn" id="leftBtn">‚Üê</div>
            <div class="btn" id="rightBtn">‚Üí</div>
        </div>
        <div class="btn" id="jumpBtn">‚Üë</div>
    </div>
</div>

<script>
    // --- 1. SETUP CANVAS ---
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    
    // Internal Resolution (Game Logic runs at this size)
    const GAME_WIDTH = 854;
    const GAME_HEIGHT = 480;

    canvas.width = GAME_WIDTH;
    canvas.height = GAME_HEIGHT;

    // --- 2. CONFIGURATION ---
    
    // MOTIVATIONAL MESSAGES (Islamic & General)
    const MESSAGES = [
        "Bismillah! ü§≤",
        "Himmat Mat Haaro! üí™",
        "Sabr (Patience) üåô",
        "Run Altamash! üèÉ‚Äç‚ôÇÔ∏è",
        "Allah is with you! ‚ù§Ô∏è",
        "Focus on the Goal! üéØ",
        "MashaAllah! ‚ú®",
        "Save the Queen! üëë"
    ];

    // CHARACTER SIZES
    const HERO_SIZE   = { w: 50, h: 80 }; 
    const QUEEN_SIZE  = { w: 50, h: 80 }; 
    const WIZARD_SIZE = { w: 60, h: 80 }; 
    const TREE_SIZE   = { w: 60, h: 140 };
    const COIN_SIZE   = { w: 30, h: 30 };

    // --- 3. ASSETS ---
    const assets = {
        hero: new Image(), queen: new Image(), bg: new Image(), coin: new Image(), wizard: new Image(),
        rainSound: new Audio("rain.mp3"), 
        coinSound: new Audio("coin.mp3"),
        winSound: new Audio("win.mp3"), 
        loseSound: new Audio("lose.mp3")
    };

    // Using your GitHub links
    assets.hero.src = "https://raw.githubusercontent.com/Mustafashk786/run/refs/heads/main/altamash.png"; 
    assets.queen.src = "https://raw.githubusercontent.com/Mustafashk786/run/refs/heads/main/queen.png"; 
    assets.bg.src = "https://raw.githubusercontent.com/Mustafashk786/run/refs/heads/main/bg.png"; 
    assets.wizard.src = "https://raw.githubusercontent.com/Mustafashk786/run/refs/heads/main/sakib.png"; 
    assets.coin.src = "coin.png"; // Local fallback if no link provided

    assets.rainSound.loop = true;
    let soundEnabled = false;

    // --- 4. GAME VARIABLES ---
    let gameRunning = true;
    let score = 0;
    let cameraX = 0;
    let frameCount = 0;
    let activeMessage = "Tap Controls to Start";

    const player = { 
        x: 100, y: 200, 
        w: HERO_SIZE.w, h: HERO_SIZE.h, 
        vx: 0, vy: 0, speed: 6, jump: -14, 
        grounded: false, facingRight: true 
    };

    const rainDrops = Array.from({length: 80}, () => ({ 
        x: Math.random() * GAME_WIDTH, 
        y: Math.random() * GAME_HEIGHT, 
        speed: Math.random() * 10 + 10 
    }));
    
    let projectiles = [];

    // --- 5. LEVEL MAP (Y-coordinates adjusted for Mobile view) ---
    // Ground Y is usually around 400 now
    const level = [
        {x: 0, y: 400, w: 800, h: 80, type: 1}, // Start Ground
        {x: 300, y: 300, w: COIN_SIZE.w, h: COIN_SIZE.h, type: 3}, 
        {x: 500, y: 260, w: TREE_SIZE.w, h: TREE_SIZE.h, type: 7},

        // Wizard Area
        {x: 900, y: 400, w: 400, h: 80, type: 1},
        {x: 1100, y: 320, w: WIZARD_SIZE.w, h: WIZARD_SIZE.h, type: 9},

        // Jumps
        {x: 1400, y: 350, w: 150, h: 40, type: 1},
        {x: 1650, y: 300, w: 150, h: 40, type: 1},
        {x: 1700, y: 250, w: COIN_SIZE.w, h: COIN_SIZE.h, type: 3},

        // Forest Run
        {x: 1900, y: 400, w: 600, h: 80, type: 1},
        {x: 2000, y: 260, w: TREE_SIZE.w, h: TREE_SIZE.h, type: 7},
        {x: 2200, y: 260, w: TREE_SIZE.w, h: TREE_SIZE.h, type: 7},
        {x: 2100, y: 320, w: WIZARD_SIZE.w, h: WIZARD_SIZE.h, type: 9},

        // Final Stretch
        {x: 2600, y: 400, w: 600, h: 80, type: 1},
        {x: 2900, y: 320, w: WIZARD_SIZE.w, h: WIZARD_SIZE.h, type: 9},
        {x: 3100, y: 310, w: QUEEN_SIZE.w, h: QUEEN_SIZE.h, type: 4} // Queen
    ];

    let keys = { left: false, right: false, up: false };

    // --- 6. AUDIO SYSTEM ---
    document.getElementById("mute-btn").onclick = () => {
        soundEnabled = !soundEnabled;
        const btn = document.getElementById("mute-btn");
        if(soundEnabled) { 
            btn.innerHTML = "üîä"; 
            assets.rainSound.play().catch(()=>{}); 
        } else { 
            btn.innerHTML = "üîá"; 
            assets.rainSound.pause(); 
        }
    };

    function playSfx(audio) {
        if(soundEnabled && audio.readyState >= 2) {
            audio.currentTime = 0;
            audio.play().catch(()=>{});
        }
    }

    // --- 7. GAME LOOP ---
    function update() {
        if(!gameRunning) return;
        frameCount++;

        // Message Timer (Every 3 seconds)
        if (frameCount % 180 === 0) {
            activeMessage = MESSAGES[Math.floor(Math.random() * MESSAGES.length)];
        }

        // Physics
        if (keys.right) { player.vx = player.speed; player.facingRight = true; }
        else if (keys.left) { player.vx = -player.speed; player.facingRight = false; }
        else { player.vx = 0; }

        if (keys.up && player.grounded) { player.vy = player.jump; player.grounded = false; }

        player.vy += 0.7; // Gravity
        player.x += player.vx;
        player.y += player.vy;

        // Camera
        cameraX = player.x - 100;

        // Rain Logic
        rainDrops.forEach(d => {
            d.y += d.speed; d.x -= 2;
            if (d.y > GAME_HEIGHT) { d.y = -20; d.x = cameraX + Math.random() * GAME_WIDTH + 100; }
        });

        // Wizard AI
        if (frameCount % 150 === 0) { 
            level.forEach(p => {
                if (p.type === 9) { 
                    if (Math.abs(player.x - p.x) < 500) { 
                        projectiles.push({ x: p.x, y: p.y + 30, vx: -5, w: 20, h: 20 });
                    }
                }
            });
        }

        // Projectiles Update
        for (let i = projectiles.length - 1; i >= 0; i--) {
            let p = projectiles[i];
            p.x += p.vx;
            if (p.x < cameraX - 100) projectiles.splice(i, 1);
            if (rectIntersect(player.x, player.y, player.w, player.h, p.x, p.y, p.w, p.h)) {
                endGame(false);
            }
        }

        // Void Death
        if(player.y > GAME_HEIGHT + 100) endGame(false);
        checkCollisions();
    }

    function checkCollisions() {
        player.grounded = false;
        for (let i = 0; i < level.length; i++) {
            let p = level[i];
            if (rectIntersect(player.x, player.y, player.w, player.h, p.x, p.y, p.w, p.h)) {
                if (p.type === 1) { // Ground
                    if (player.vy > 0 && player.y + player.h - player.vy <= p.y + 15) {
                        player.grounded = true; player.vy = 0; player.y = p.y - player.h;
                    }
                }
                else if (p.type === 3) { // Coin
                    score++; playSfx(assets.coinSound);
                    document.getElementById("score-board").innerHTML = "üí∞ " + score;
                    level.splice(i, 1);
                }
                else if (p.type === 4) endGame(true); // Win
            }
        }
    }

    function rectIntersect(x1, y1, w1, h1, x2, y2, w2, h2) {
        return x2 < x1 + w1 && x2 + w2 > x1 && y2 < y1 + h1 && y2 + h2 > y1;
    }

    function endGame(win) {
        gameRunning = false;
        const msg = document.getElementById("message");
        msg.style.display = "block";
        if(win) {
            msg.innerHTML = "QUEEN SAVED! ‚ù§Ô∏è<br><span style='font-size:20px'>Tap to Play Again</span>";
            msg.style.color = "#00ff00";
            playSfx(assets.winSound);
        } else {
            msg.innerHTML = "YOU DIED ‚ò†Ô∏è<br><span style='font-size:20px'>Tap to Restart</span>";
            msg.style.color = "red";
            playSfx(assets.loseSound);
        }
        assets.rainSound.pause();
        setTimeout(() => { document.body.onclick = () => location.reload(); }, 500);
    }

    // --- 8. DRAWING ---
    function draw() {
        // Clear
        ctx.fillStyle = "#0d1117";
        ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);

        // Draw BG
        if (assets.bg.complete && assets.bg.naturalWidth !== 0) {
            ctx.drawImage(assets.bg, 0, 0, GAME_WIDTH, GAME_HEIGHT);
        }

        ctx.save();
        ctx.translate(-cameraX, 0);

        // Draw Messages
        ctx.font = "bold 20px sans-serif";
        ctx.fillStyle = "rgba(255, 255, 255, 0.9)";
        ctx.textAlign = "center";
        // Ensure message stays on top center relative to camera
        ctx.fillText(activeMessage, cameraX + GAME_WIDTH/2, 60);

        // Draw Level
        level.forEach(p => {
            if (p.type === 1) { 
                ctx.fillStyle = "#444"; ctx.fillRect(p.x, p.y, p.w, p.h);
                ctx.strokeStyle = "#777"; ctx.strokeRect(p.x, p.y, p.w, p.h);
            } 
            else if (p.type === 3) { 
                if (assets.coin.complete && assets.coin.naturalWidth !== 0) ctx.drawImage(assets.coin, p.x, p.y, p.w, p.h);
                else { ctx.fillStyle = "gold"; ctx.beginPath(); ctx.arc(p.x + p.w/2, p.y + p.h/2, p.w/2, 0, Math.PI*2); ctx.fill(); }
            }
            else if (p.type === 4) { 
                if (assets.queen.complete && assets.queen.naturalWidth !== 0) ctx.drawImage(assets.queen, p.x, p.y, p.w, p.h);
                else { ctx.fillStyle = "#ff00ff"; ctx.fillRect(p.x, p.y, p.w, p.h); }
            }
            else if (p.type === 7) { 
                ctx.fillStyle = "#5D4037"; ctx.fillRect(p.x + p.w/4, p.y + 50, p.w/2, 100);
                ctx.fillStyle = "#388E3C"; ctx.beginPath(); ctx.arc(p.x + p.w/2, p.y + 50, p.w, 0, Math.PI*2); ctx.fill();
            }
            else if (p.type === 9) { // Wizard
                if (assets.wizard.complete && assets.wizard.naturalWidth !== 0) {
                    ctx.drawImage(assets.wizard, p.x, p.y, p.w, p.h);
                } else {
                    ctx.fillStyle = "purple"; ctx.fillRect(p.x, p.y, p.w, p.h);
                }
            }
        });

        // Fireballs
        ctx.fillStyle = "#ff4500";
        projectiles.forEach(p => {
            ctx.beginPath(); ctx.arc(p.x + p.w/2, p.y + p.h/2, 10, 0, Math.PI*2); ctx.fill();
        });

        // Player
        if (assets.hero.complete && assets.hero.naturalWidth !== 0) {
            ctx.save();
            if (!player.facingRight) { 
                ctx.translate(player.x + player.w, player.y); 
                ctx.scale(-1, 1); 
                ctx.drawImage(assets.hero, 0, 0, player.w, player.h); 
            } else { 
                ctx.drawImage(assets.hero, player.x, player.y, player.w, player.h); 
            }
            ctx.restore();
        } else {
            ctx.fillStyle = "#3498db"; ctx.fillRect(player.x, player.y, player.w, player.h);
        }

        ctx.restore();

        // Rain Overlay
        ctx.strokeStyle = "rgba(100, 150, 255, 0.4)"; 
        ctx.lineWidth = 1; 
        ctx.beginPath();
        rainDrops.forEach(d => { ctx.moveTo(d.x, d.y); ctx.lineTo(d.x - 2, d.y + 10); });
        ctx.stroke();

        requestAnimationFrame(() => { update(); draw(); });
    }

    // --- 9. TOUCH INPUTS ---
    const leftBtn = document.getElementById("leftBtn");
    const rightBtn = document.getElementById("rightBtn");
    const jumpBtn = document.getElementById("jumpBtn");

    leftBtn.ontouchstart = (e) => { e.preventDefault(); keys.left = true; };
    leftBtn.ontouchend = (e) => { e.preventDefault(); keys.left = false; };
    rightBtn.ontouchstart = (e) => { e.preventDefault(); keys.right = true; };
    rightBtn.ontouchend = (e) => { e.preventDefault(); keys.right = false; };
    jumpBtn.ontouchstart = (e) => { e.preventDefault(); keys.up = true; };
    jumpBtn.ontouchend = (e) => { e.preventDefault(); keys.up = false; };

    // Keyboard support
    window.addEventListener("keydown", e => { if(e.key === "ArrowLeft") keys.left = true; if(e.key === "ArrowRight") keys.right = true; if(e.key === " " || e.key === "ArrowUp") keys.up = true; });
    window.addEventListener("keyup", e => { if(e.key === "ArrowLeft") keys.left = false; if(e.key === "ArrowRight") keys.right = false; if(e.key === " " || e.key === "ArrowUp") keys.up = false; });

    update(); draw();
</script>
</body>
</html>
